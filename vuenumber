PCEtLSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAgIEJhc2UgY2hvIMO0IG51bWJlciBpbnB1dA0KICAgIEJhbyBn4buTbSBjw6FjIHTDrW5oIG7Eg25nOg0KICAgICAgKyBU4buxIMSR4buZbmcgZm9tYXQgbG/huqFpIHRp4buBbiB04buHLCBz4buRIGzGsOG7o25nIChjw7MgbmfEg24gY8OhY2ggZ2nhu69hIGPDoWMgc+G7kSBwaOG6p24gbmd1ecOqbiB2w6AgcGjDom4gdMOhY2ggcGjhuqduIG5ndXnDqm4gdsOgIHBo4bqnbiB0aOG6rXAgcGjDom4pDQogICAgICArIFPhu5EgdOG7sSDEkeG7mW5nIGPEg24gcGjhuqNpDQogICAgICArIEF1dG8gZm91Y3VzDQogICAgQ3JlYXRlZCBieSBubmFuaDIgLSAyNC8wNi8yMDE5DQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gLS0+DQoNCjx0ZW1wbGF0ZT4NCiAgPGRpdiBjbGFzcz0ibXMtbnVtYmVyIG1zLWVkaXRvciB3LTEwMCI+DQogICAgPGRpdg0KICAgICAgY2xhc3M9ImZsZXgtcm93IGJvcmRlciINCiAgICAgIDpjbGFzcz0ieyBlcnJvcjogZXJyb3JQcm92aWRlci5pc1ZhbGlkIHx8IGhhc0VyciwgZGlzYWJsZWQ6IGRpc2FibGVkIH0iDQogICAgPg0KICAgICAgPGlucHV0DQogICAgICAgIHJlZj0iaW5wdXQiDQogICAgICAgIHYtYmluZD0iJGF0dHJzIg0KICAgICAgICB2LW9uPSJsaXN0ZW5lcnMiDQogICAgICAgIDphdXRvZm9jdXM9ImF1dG9mb2N1cyINCiAgICAgICAgOnN0ZXA9InN0ZXAiDQogICAgICAgIDpyZWFkb25seT0icmVhZE9ubHkiDQogICAgICAgIDpjbGFzcz0iWydtcy1udW1iZXItaXRlbSBmbGV4J10iDQogICAgICAgIDpkaXNhYmxlZD0iZGlzYWJsZWQiDQogICAgICAgIDp0YWJpbmRleD0iMCINCiAgICAgICAgQGtleWRvd249InVwRG93blZhbHVlIg0KICAgICAgICBAY2xpY2s9Im9uSW5wdXRDbGljayINCiAgICAgICAgQGZvY3VzPSJvbklucHV0Rm9jdXMiDQogICAgICAvPg0KICAgICAgPGRpdg0KICAgICAgICBjbGFzcz0iaWNvbjI0IGVycm9yIGVycm9yLWljb24iDQogICAgICAgIHYtc2hvdz0iZXJyb3JQcm92aWRlci5pc1ZhbGlkICYmICFpc1Nob3dUZXh0Ig0KICAgICAgICA6dGl0bGU9ImVycm9yUHJvdmlkZXIubWVzc2FnZSINCiAgICAgID48L2Rpdj4NCg0KICAgICAgPGRpdiBjbGFzcz0ibXMtbnVtYmVyLXNwaW4gZmxleC1jb2x1bW4iIHYtaWY9InNwaW4iPg0KICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IHNwaW4gdXAiIEBjbGljaz0icGx1cygpIj48L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBzcGluIGRvd24iIEBjbGljaz0ibGVzcygpIj48L2Rpdj4NCiAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KICAgIDxkaXYgY2xhc3M9InRleHQtY3VycmVuY3kiIHYtaWY9ImN1cnJlbmN5VHlwZSAhPSBudWxsIj4NCiAgICAgIHt7IGN1cnJlbmN5VHlwZSB9fQ0KICAgIDwvZGl2Pg0KICAgIDxkaXYgY2xhc3M9InJldmVudWUgbWFyZ2luLXQtMTAiIHYtaWY9ImN1c3RvbVRleHQgIT0gbnVsbCI+DQogICAgICB7eyBjdXN0b21UZXh0IH19DQogICAgPC9kaXY+DQogICAgPGRpdiBjbGFzcz0iZXJyb3ItdGV4dCIgdi1pZj0iZXJyb3JQcm92aWRlci5pc1ZhbGlkICYmIGlzU2hvd1RleHQiPg0KICAgICAge3sgZXJyb3JQcm92aWRlci5tZXNzYWdlIH19DQogICAgPC9kaXY+DQogIDwvZGl2Pg0KPC90ZW1wbGF0ZT4NCg0KPHNjcmlwdD4NCmltcG9ydCBBdXRvTnVtZXJpYyBmcm9tICJhdXRvbnVtZXJpYyI7DQppbXBvcnQgbXNCYXNlQ29tcG9uZW50IGZyb20gIkAvY29tcG9uZW50cy9tc2Jhc2UvbXNCYXNlQ29tcG9uZW50LnZ1ZSI7DQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIk1zTnVtYmVyIiwNCiAgZXh0ZW5kczogbXNCYXNlQ29tcG9uZW50LA0KICBpbmhlcml0QXR0cnM6IGZhbHNlLA0KDQogIHByb3BzOiB7DQogICAgdmFsdWU6IHsNCiAgICAgIGRlZmF1bHQ6ICIiLA0KICAgICAgdHlwZTogW1N0cmluZywgTnVtYmVyXSwNCiAgICB9LA0KICAgIGN1c3RvbVRleHQ6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgfSwNCiAgICBjdXJyZW5jeVR5cGU6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgfSwNCiAgICAvL2PDsyBjaG8gcGjDqXAgc2hvdyB0ZXh0IHZhbGlkYXRlIGLDqm4gZMaw4bubaSBjZWxsIGsNCiAgICBpc1Nob3dUZXh0OiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogdHJ1ZSwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEPhuqV1IGjDrG5oIGNobyBpY29uIGLDqm4gcGjhuqNpDQogICAgICovDQogICAgaGFzQ2VsbEJ1dHRvbnM6IHsNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEdpw6EgdHLhu4sgbmjhu48gbmjhuqV0IGNobyBwaMOpcCBuaOG6rXANCiAgICAgKi8NCiAgICBtaW46IHsNCiAgICAgIGRlZmF1bHQ6IC0xMDAwMDAwMDAwMCwNCiAgICAgIHR5cGU6IFtOdW1iZXIsIFN0cmluZ10sDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBHacOhIHRy4buLIGzhu5tuIG5o4bqldCBjaG8gcGjDqXAgbmjhuq1wDQogICAgICovDQogICAgbWF4OiB7DQogICAgICBkZWZhdWx0OiAxMDAwMDAwMDAwMDAwMDAsDQogICAgICB0eXBlOiBbTnVtYmVyLCBTdHJpbmddLA0KICAgIH0sDQogICAgLyoqDQogICAgICogVOG7sSDEkeG7mW5nIGZvY3VzDQogICAgICovDQogICAgYXV0b2ZvY3VzOiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IFtCb29sZWFuLCBTdHJpbmddLA0KICAgIH0sDQogICAgLyoqDQogICAgICogQsaw4bubYyBuaOG6o3kgY+G7p2EgZ2nDoSB0cuG7iw0KICAgICAqLw0KICAgIHN0ZXA6IHsNCiAgICAgIGRlZmF1bHQ6IDEsDQogICAgICB0eXBlOiBbTnVtYmVyLCBTdHJpbmddLA0KICAgIH0sDQogICAgLyoqDQogICAgICogQ2hp4buBdSBjYW8gY+G7p2EgaW5wdXQNCiAgICAgKi8NCiAgICBoZWlnaHQ6IHsNCiAgICAgIC8vY2hp4buBdSBjYW8gY+G7p2Egw7QgaW5wdXQNCiAgICAgIGRlZmF1bHQ6IDMwLA0KICAgICAgdHlwZTogW051bWJlciwgU3RyaW5nXSwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEvDrWNoIHRoxrDhu5tjIMSRxrDhu51uZyB2aeG7gW4NCiAgICAgKi8NCiAgICBib3JkZXJTaXplOiB7DQogICAgICBkZWZhdWx0OiAiMXB4IiwNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIFRpw6p1IMSR4buBIGPhu6dhIGNvbnRyb2wNCiAgICAgKi8NCiAgICB0aXRsZTogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgIH0sDQogICAgLyoqDQogICAgICogRGnhu4VuIGdp4bqjaSB0aMOqbSBjaG8gY29udHJvbA0KICAgICAqLw0KICAgIHRvb2x0aXA6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIFRpdGxlIGTDoG5oIHJpw6puZyBjaG8gdmnhu4djIHjhu60gbMO9IHZhbGlkYXRpb24gdHLDqm4gZ3JpZCAoZG8ga2jDtG5nIG114buRbiBzaG93IHRpdGxlIGzDqm4pDQogICAgICovDQogICAgdGl0bGVWYWxpZGF0aW9uOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBUcsaw4budbmcgYuG6r3QgYnXhu5ljIG5o4bqtcA0KICAgICAqIE3hurdjIMSR4buLbmggZmFsc2UNCiAgICAgKi8NCiAgICByZXF1aXJlZDogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgIH0sDQogICAgLyoqDQogICAgICogS8OtIGhp4buHdSBj4bqjbmggYsOhbyB0csaw4budbmcgYuG6r3QgYnXhu5ljIG5o4bqtcCBraMO0bmcgxJHGsOG7o2MgYuG7jyB0cuG7kW5nDQogICAgICovDQogICAgdGV4dFJlcXVpcmVkOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICBkZWZhdWx0OiAiKiIsDQogICAgICByZXF1aXJlZDogZmFsc2UsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBDw7MgaGnhu4NuIHRo4buLIGvDvSB04buxIHJlcXVpcmVkIHJhIGtow7RuZw0KICAgICAqLw0KICAgIHJlcXVpcmVkVmlzaWJsZTogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgIH0sDQogICAgLyoqDQogICAgICogQ8OhYyBydWxlIHBo4bulYyB24bulIGNobyB2YWxpZGF0ZSBjb250cm9sDQogICAgICovDQogICAgcnVsZXM6IHsNCiAgICAgIHR5cGU6IFtPYmplY3QsIFN0cmluZ10sDQogICAgICBkZWZhdWx0OiAiIiwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIGlkIGPhu6dhIHZhbGlkYXRvciBwcm92aWRlcg0KICAgICAqLw0KICAgIHZpZDogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgIH0sDQogICAgLyoqDQogICAgICogQ2hvIHBow6lwIGhp4buDbiB0aOG7iyBz4buRIDAg4bufIMSR4bqndQ0KICAgICAqIFtgYWxsb3dgLCBgZGVueWAsIGBrZWVwYF0NCiAgICAgKiBN4bq3YyDEkeG7i25oIGzDoCBhbGxvdzogQ2hvIHBow6lwIG5o4bqtcCBuaMawbmcgc+G6vSBt4bqldCBraGkgZm9jdXMgcmEgYsOqbiBuZ2/DoGkNCiAgICAgKi8NCiAgICBsZWFkaW5nWmVybzogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgZGVmYXVsdDogImFsbG93IiwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEPhu50gYuG6rXQgdOG6r3QgaWNvbiB0xINuZyBnaeG6o20gZ2nDoSB0cuG7iyBj4bunYSBudW1iZXINCiAgICAgKi8NCiAgICBzcGluOiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBGb3JtYXQgZ2nDoSB0cuG7iyB0aGVvIHTDuXkgY2jhu41uIGPhu6dhIGjhu4cgdGjhu5FuZw0KICAgICAqLw0KICAgIGZvcm1hdFR5cGU6IHsNCiAgICAgIHR5cGU6IFtOdW1iZXIsIFN0cmluZ10sDQogICAgICBkZWZhdWx0OiAwLA0KICAgIH0sDQogICAgLyoqDQogICAgICogQ2hvIHBow6lwIGhp4buDbiB0aOG7iyDEkeG6p3kgxJHhu6cgc+G7kSBsxrDhu6NuZyBwaOG6p24gdGjhuq1wIHBow6JuDQogICAgICovDQogICAgYWxsb3dEZWNpbWFsUGFkZGluZzogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IHRydWUsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBDaG8gcGjDqXAgcGjDom4gdMOhY2ggY8OhYyBrw60gdOG7sSBwaOG6p24gbmd1ecOqbiB24bubaSBuaGF1DQogICAgICovDQogICAgYWxsb3dEaWdpdEdyb3VwU2VwYXJhdG9yOiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogdHJ1ZSwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIFNldCBnacOhIHRy4buLIGRlZmF1bHQgY+G7p2EgbnVtYmVyIGtoaSBuZ8aw4budaSBkw7luZyBraMO0bmcgc2V0IGdpw6EgdHLhu4sNCiAgICAgKi8NCiAgICBlbXB0eUlucHV0OiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBDaG8gcGjDqXAgY8OzIGdpw6EgdHLhu4sgbMOgIG51bGwvdW5kZWZpbmVkIG3DoCBraMO0bmcgcGjhuqNpIHNldCBt4bq3YyDEkeG7i25oIGzDoCAwDQogICAgICogQGF1dGhvciBOVkxBTSAyOC4wMi4yMDIwDQogICAgICovDQogICAgaXNOdWxsYWJsZTogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgIH0sDQogICAgcmVhZE9ubHk6IHsNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICB9LA0KICAgIGRpc2FibGVkOiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCiAgICBkZWNpbWFsUGxhY2VzOiB7DQogICAgICBkZWZhdWx0OiAwLA0KICAgICAgdHlwZTogTnVtYmVyLA0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBYw6FjIMSR4buLbmggaW5wdXQgY8OzIGzhu5dpIGhheSBrbw0KICAgICAqIENyZWF0ZWRCeTogZGJodWFuIDA5LzEwLzIwMjENCiAgICAgKi8NCiAgICBoYXNFcnI6IHsNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICB9LA0KICB9LA0KDQogIGNvbXB1dGVkOiB7DQogICAgbGlzdGVuZXJzKCkgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgLi4udGhpcy4kbGlzdGVuZXJzLA0KICAgICAgICBpbnB1dDogKGV2dCkgPT4gew0KICAgICAgICAgIC8vICB0aGlzLiRlbWl0KCJpbnB1dCIsIGV2dC50YXJnZXQudmFsdWUpOw0KICAgICAgICAgIHRoaXMub25JbnB1dCgpOw0KICAgICAgICB9LA0KICAgICAgICBjaGFuZ2U6IChldnQpID0+IHsNCiAgICAgICAgICB0aGlzLiRlbWl0KCJjaGFuZ2UiLCB0aGlzLmdldFZhbHVlKCksIGV2dCk7DQogICAgICAgIH0sDQogICAgICAgIGJsdXI6IChldmVudCkgPT4gew0KICAgICAgICAgIHRoaXMub25CbHVyKCk7DQogICAgICAgICAgdGhpcy5mb2N1c2VkID0gZmFsc2U7DQogICAgICAgICAgdGhpcy4kZW1pdCgiYmx1ciIsIHRoaXMuZ2V0VmFsdWUoKSwgZXZlbnQpOw0KICAgICAgICB9LA0KICAgICAgICBrZXlkb3duOiAoZXZlbnQpID0+IHRoaXMuJGVtaXQoImtleWRvd24iLCBldmVudCksDQogICAgICAgIGtleXVwOiAoZXZlbnQpID0+IHRoaXMuJGVtaXQoImtleXVwIiwgZXZlbnQpLA0KICAgICAgICBmb2N1czogKGV2ZW50KSA9PiB7DQogICAgICAgICAgdGhpcy5zZWxlY3RPbkNsaWNrID0gdHJ1ZTsNCiAgICAgICAgICAvLyBwdmR1b25nMSAtIDA2LzA0LzIwMjAgLSBLaGkgZm9jdXMgdsOgbyB0aMOsIHNlbGVjdCBhbGwgZOG7ryBsaeG7h3UgdHJvbmcgY29udHJvbGwNCiAgICAgICAgICBldmVudC50YXJnZXQuc2VsZWN0KCk7DQogICAgICAgICAgdGhpcy5mb2N1c2VkID0gdHJ1ZTsNCiAgICAgICAgICB0aGlzLiRlbWl0KCJmb2N1cyIsIGV2ZW50KTsNCiAgICAgICAgICB0aGlzLmNoYW5nZUZvY3VzKHRydWUpOw0KICAgICAgICB9LA0KICAgICAgICBjbGljazogKGV2dCkgPT4gew0KICAgICAgICAgIC8vIHRoaXMuc2VsZWN0QWxsVGV4dFdoZW5DbGljayh0aGlzLiRyZWZzLmlucHV0KTsNCiAgICAgICAgfSwNCiAgICAgICAgImF1dG9OdW1lcmljOnJhd1ZhbHVlTW9kaWZpZWQiOiB0aGlzLnVwZGF0ZVZNb2RlbCwNCiAgICAgIH07DQogICAgfSwNCiAgICBib2RlcklucHV0KCkgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgYm9yZGVyOiBgJHt0aGlzLmJvcmRlclNpemV9IHNvbGlkIHJnYigxODYsIDE5MCwgMTk3KWAsDQogICAgICB9Ow0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fQ0KICAgICAqLw0KICAgIGFuSW5mbygpIHsNCiAgICAgIHJldHVybiB7DQogICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlLA0KICAgICAgICBudW1iZXJGb3JtYXQ6IHRoaXMuJG1zLnNlc3Npb24sDQogICAgICB9Ow0KICAgIH0sDQogIH0sDQoNCiAgd2F0Y2g6IHsNCiAgICAvKioNCiAgICAgKiBT4butYSBs4bqhaSB3YXRjaCB0aGVvIHZhbHVlIHRoZW8gaMaw4bubbmcgZOG6q24gY+G7p2EgYW5oIGJuZHVjDQogICAgICogQGF1dGhvciBwY21pbmggMTMuMDUuMjAyMA0KICAgICAqLw0KICAgIHZhbHVlKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgaWYgKA0KICAgICAgICAvLyBNYWtlIHN1cmUgdGhpcyBpcyBvbmx5IGNhbGxlZCB3aGVuIHRoZSB2YWx1ZSBpcyBzZXQgYnkgYW4gZXh0ZXJuYWwgc2NyaXB0LCBhbmQgbm90IGZyb20gYSB1c2VyIGlucHV0DQogICAgICAgIG1lLmdldFZhbHVlKCkgIT09IG5ld1ZhbHVlICYmDQogICAgICAgIC8vIENvbXBhcmUgdGhlICduZXdWYWx1ZScgd2l0aCB0aGUgY3VycmVudCAnb2xkVmFsdWUnIHNvIHdlIGRvIG5vdCBgc2V0YCBpdCBhZ2FpbiBpZiBpdCdzIG5vdCBuZWVkZWQNCiAgICAgICAgbmV3VmFsdWUgIT09IG9sZFZhbHVlDQogICAgICApIHsNCiAgICAgICAgLy8gVGhlIG1vZGlmaWNhdGlvbiBjb21lcyBmcm9tIGEgc2NyaXB0LCBzbyB3ZSBuZWVkIHRvIHJlZm9ybWF0IHRoZSBuZXcgdmFsdWUgYG5ld1ZhbHVlLnZhbHVlYA0KDQogICAgICAgIG1lLmF1dG9OdW1lcmljLnNldChuZXdWYWx1ZSk7DQogICAgICB9DQoNCiAgICAgIC8vIGlmIChtZS50eXBpbmcpew0KICAgICAgbWUuJGVtaXQoImNoYW5nZVZhbHVlIiwgbmV3VmFsdWUsIG9sZFZhbHVlLCBtZSk7DQogICAgICAvLyB9DQogICAgfSwNCiAgfSwNCg0KICBtb3VudGVkKCkgew0KICAgIC8vIEluaXRpYWxpemUgdGhlIGF1dG9OdW1lcmljIGVsZW1lbnQNCg0KICAgIGxldCBtZSA9IHRoaXMsDQogICAgICBvcHRpb25zID0gbWUuaW5pdE9wdGlvbnMoKTsNCiAgICBpZiAobWUuZW1wdHlJbnB1dCkgew0KICAgICAgb3B0aW9ucy5lbXB0eUlucHV0QmVoYXZpb3IgPSAiemVybyI7DQogICAgfQ0KICAgIC8vYuG7jyDEkWkgxJHhu4MgY29udHJvbCB0csOqbiBncmlkIGtoaSBhbHQrdGFiIHhlbSBz4buRIGxp4buHdSDhu58gY2jhu5cga2jDoWMgcXVheSBs4bqhaSB0aMOsIGLhu4sgc2VsZWN0IGFsbCB0ZXh0DQogICAgb3B0aW9ucy5zZWxlY3RPbkZvY3VzID0gZmFsc2U7DQogICAgbWUuYXV0b051bWVyaWMgPSBuZXcgQXV0b051bWVyaWMobWUuJHJlZnMuaW5wdXQsIG9wdGlvbnMpOw0KDQogICAgaWYgKA0KICAgICAgdGhpcy52YWx1ZSAhPT0gbnVsbCAmJg0KICAgICAgdGhpcy52YWx1ZSAhPT0gIiIgJiYNCiAgICAgIHR5cGVvZiB0aGlzLnZhbHVlICE9PSAidW5kZWZpbmVkIg0KICAgICkgew0KICAgICAgdGhpcy5hdXRvTnVtZXJpYy5zZXQodGhpcy52YWx1ZSk7DQogICAgICAvLyBUaGUgYHYtbW9kZWxgIG11c3QgYmUgdXBkYXRlZCB3aXRoIHRoYXQgZGVmYXVsdCB2YWx1ZSBvbiBzdGFydHVwDQogICAgICB0aGlzLnVwZGF0ZVZNb2RlbCgpOw0KICAgIH0NCiAgfSwNCg0KICAvKioNCiAgICogQ2h1eeG7g24gbeG7mXQgc+G7kSBiaeG6v24ga2jDtG5nIGPhuqduIHJlYWN0aXZlIHbDoG8gxJHDonkgxJHhu4MgdOG7kWkgxrB1DQogICAqLw0KICBjcmVhdGVkKCkgew0KICAgIGNvbnN0IG1lID0gdGhpczsNCg0KICAgIC8qKg0KICAgICAqIEPhu50geMOhYyDEkeG7i25oIGPDsyBwaOG6o2kgbmfGsOG7nWkgZMO5bmcgxJFhbmcgdGjhu7FjIGhp4buHbiB0eXBpbmcgdHLDqm4gY29udHJvbCBoYXkga2jDtG5nDQogICAgICovDQogICAgbWUudHlwaW5nID0gZmFsc2U7DQogICAgbWUudmFsaWQgPSBmYWxzZTsNCiAgICBtZS5hdXRvTnVtZXJpYyA9IG51bGw7DQogIH0sDQoNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgZm9jdXNlZDogZmFsc2UsDQogICAgICAvLyBudW1iZXJJbnB1dDogdGhpcy52YWx1ZSA9PSBudWxsPycnOnRoaXMudmFsdWUudG9TdHJpbmcoKSwNCiAgICAgIC8vIGF1dG9OdW1lcmljOiBudWxsLA0KICAgICAgLy8gd2lkdGg6ICcnLA0KICAgIH07DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvLyBT4buxIGtp4buHbiBibHVyDQogICAgYmx1ckhhbmRsZXIodmFsaWQsIGVycm9ycykgew0KICAgICAgbGV0IG1lID0gdGhpczsNCiAgICAgIGlmICghdmFsaWQpIHsNCiAgICAgICAgdGhpcy4kZW1pdCgidmFsaWRhdGlvbkVycm9yIiwgZXJyb3JzKTsNCiAgICAgIH0NCiAgICAgIHRoaXMuY2hhbmdlRm9jdXMoZmFsc2UpOw0KICAgIH0sDQogICAgLyoqDQogICAgICogVGhheSDEkeG7lWkgdHLhuqFuZyB0aMOhaSBmb2N1cw0KICAgICAqLw0KICAgIGNoYW5nZUZvY3VzKGJvb2xlYW54KSB7DQogICAgICB0aGlzLmZvY3VzZWQgPSBib29sZWFueDsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIFRo4buxYyBoaeG7h24gZm9jdXMgdsOgbyDDtCBpbnB1dCBudW1iZXINCiAgICAgKi8NCiAgICBmb2N1c0lucHV0KCkgew0KICAgICAgdGhpcy4kcmVmcy5pbnB1dC5mb2N1cygpOw0KICAgIH0sDQogICAgLyoqDQogICAgICogU2F1IHPhur0gYuG7lSBzdW5nIHRow6ptIERhdGFUeXBlIChT4buRIHRp4buBbiwgU+G7kSBsxrDhu6NuZywgdOG7tyBs4buHLC4uLikgxJHhu4MgeMOhYyDEkeG7i25oIMSRw7puZyDEkeG7i25oIGThuqFuZw0KICAgICAqIFZp4buHYyBraOG7n2kgdOG6oW8gbsOgeSBzYXUgbsOgeSBz4bq9IMSR4buDIDEgb2JqZWN0IG3hurdjIMSR4buLbmggdHLDqm4gc2Vzc2lvbiDEkeG7gyB04buRaSDGsHUNCiAgICAgKi8NCiAgICBpbml0T3B0aW9ucygpIHsNCiAgICAgIGxldCBtZSA9IHRoaXM7DQogICAgICBsZXQgb3B0aW9ucyA9IHsNCiAgICAgICAgYWxsb3dEZWNpbWFsUGFkZGluZzogbWUuYWxsb3dEZWNpbWFsUGFkZGluZywgLy9DaG8gcGjDqXAgaGnhu4NuIHRo4buLIMSR4bqneSDEkeG7pyBz4buRIGzGsOG7o25nIHBo4bqnbiB0aOG6rXAgcGjDom4NCiAgICAgICAgZGVjaW1hbENoYXJhY3RlcjogIiwiLCAvL0vDrSB04buxIHBow6JuIHTDoWNoIHBo4bqnbiBuZ3V5w6puIHbhu5tpIHBo4bqnbiB0aOG6rXAgcGjDom4NCiAgICAgICAgZGlnaXRHcm91cFNlcGFyYXRvcjogIi4iLCAvL0vDrSB04buxIHBow6JuIHTDoWNoIHBo4bqnbiBuZ3V5w6puIHbhu5tpIG5oYXUNCiAgICAgICAgZGVjaW1hbENoYXJhY3RlckFsdGVybmF0aXZlOiAiLiIsDQogICAgICAgIG5lZ2F0aXZlUG9zaXRpdmVTaWduUGxhY2VtZW50OiAicCIsIC8vc2V0IHbhu4sgdHLDrSBk4bqldSDDom06IFtwIC0gcHJlZml4LCBzIC0gc3VmZml4LCByIC0gcmlnaHQsIGwgLSBsZWZ0XQ0KICAgICAgICAvLyBlbXB0eUlucHV0QmVoYXZpb3IgOiAnemVybycsIC8vc2V0IGdpw6EgdHLhu4sgaGnhu4NuIHRo4buLIG3hurdjIMSR4buLbmgga2hpIG51bWJlciBrbyBjw7MgZ2nDoSB0cuG7iyBsw6AgMA0KICAgICAgICBtb2RpZnlWYWx1ZU9uV2hlZWw6ICJmYWxzZSIsIC8vaOG7lyB0cuG7oyBjw7MgbMSDbiBjaHXhu5l0IHRoYXkgxJHhu5VpIGdpw6EgdHLhu4sgaGF5IGtow7RuZw0KICAgICAgICAvLyBjdXJyZW5jeVN5bWJvbDogc2Vzc2lvbk9iai5DdXJyZW5jeVN5bWJvbCwNCiAgICAgICAgY3VycmVuY3lTeW1ib2xQbGFjZW1lbnQ6ICJzIiwgLy924buLIHRy4buLIMSR4bq3dCBk4bqldSB0aeG7gW4gdOG7hw0KICAgICAgICAvLyByb3VuZGluZ01ldGhvZDogJ1UnLA0KICAgICAgICBtYXhpbXVtVmFsdWU6IG1lLm1heCwNCiAgICAgICAgbWluaW11bVZhbHVlOiBtZS5taW4sDQogICAgICAgIGxlYWRpbmdaZXJvOiBtZS5sZWFkaW5nWmVybywgLy9jaG8gcGjDqXAgZ2nhu68gc+G7kSAwIOG7nyDEkeG6p3UNCiAgICAgIH07DQogICAgICBpZiAobWUuYWxsb3dEaWdpdEdyb3VwU2VwYXJhdG9yID09PSBmYWxzZSkgew0KICAgICAgICBvcHRpb25zLmRpZ2l0R3JvdXBTZXBhcmF0b3IgPSAiIjsNCiAgICAgIH0NCiAgICAgIG9wdGlvbnMuZGVjaW1hbFBsYWNlcyA9IG1lLmRlY2ltYWxQbGFjZXM7DQogICAgICByZXR1cm4gb3B0aW9uczsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogVXBkYXRlIHRoZSB2LW1vZGVsIHZhbHVlIGFuZCBtYWtlIHRoZSBwYXJlbnQgYXdhcmUgb2YgdGhhdCBjaGFuZ2UuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudCBUaGlzIGlzIG5lZWRlZCBpZiB3ZSB3YW50IHRvIHVzZSB0aGUgYGV2ZW50LnRpbWVTdGFtcGAgYXR0cmlidXRlDQogICAgICovDQogICAgdXBkYXRlVk1vZGVsKGV2ZW50KSB7DQogICAgICBsZXQgbWUgPSB0aGlzOw0KICAgICAgaWYgKG1lLmF1dG9OdW1lcmljICE9IG51bGwpIHsNCiAgICAgICAgbGV0IHZhbHVlID0gbWUuZ2V0VmFsdWUoKTsNCiAgICAgICAgbWUuJGVtaXQoImlucHV0IiwgdmFsdWUsIGV2ZW50KTsNCiAgICAgICAgbWUuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgICB0aGlzLnZhbGlkYXRlKHRoaXMpOw0KICAgICAgICB9KTsNCiAgICAgICAgLy8gbWUuJGVtaXQoJ2NoYW5nZScsIHZhbHVlLCBldmVudCk7DQogICAgICB9DQogICAgfSwNCg0KICAgIHVwRG93blZhbHVlKGUpIHsNCiAgICAgIGxldCBtZSA9IHRoaXM7DQogICAgICBpZiAobWUuc3Bpbikgew0KICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzgpIHsNCiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgIHRoaXMucGx1cygpOw0KICAgICAgICB9DQogICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSA0MCkgew0KICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgdGhpcy5sZXNzKCk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmIChtZS5pc0dyaWRFZGl0b3IpIHsNCiAgICAgICAgICBsZXQgZWwgPSBtZS4kcmVmcy5pbnB1dDsNCiAgICAgICAgICBpZiAoDQogICAgICAgICAgICBlbC5zZWxlY3Rpb25TdGFydCA9PSAwICYmDQogICAgICAgICAgICBlbC5zZWxlY3Rpb25FbmQgPT0gZWwudmFsdWUubGVuZ3RoICYmDQogICAgICAgICAgICAoZS53aGljaCA9PSAzOSB8fCBlLndoaWNoID09IDM3KQ0KICAgICAgICAgICkgew0KICAgICAgICAgICAgbGV0IHJlYWRvbmx5ID0gZWwucmVhZE9ubHk7DQogICAgICAgICAgICBpZiAoIWVsLnJlYWRPbmx5KSB7DQogICAgICAgICAgICAgIGVsLnJlYWRPbmx5ID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgIGVsLnJlYWRPbmx5ID0gcmVhZG9ubHk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIHBsdXMoKSB7DQogICAgICAvL2Rpc2FibGUgdGjDrCBraMO0bmcgbMOgbSBnw6wNCiAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5jaGFuZ2VGb2N1cyh0cnVlKTsNCiAgICAgIGxldCBtZSA9IHRoaXM7DQogICAgICBsZXQgdmFsdWUgPSBtZS5nZXRWYWx1ZSgpOw0KICAgICAgaWYgKCF2YWx1ZSkgew0KICAgICAgICB2YWx1ZSA9IDA7DQogICAgICB9DQogICAgICB2YWx1ZSA9IHBhcnNlSW50KHZhbHVlKTsNCiAgICAgIGlmICh2YWx1ZSA8IG1lLm1heCkgew0KICAgICAgICB2YWx1ZSArPSBtZS5zdGVwOw0KICAgICAgICAvLyBpZiAodmFsdWUgPCAxMCkgew0KICAgICAgICAvLyAJdmFsdWUgPSAnMCcgKyB2YWx1ZTsNCiAgICAgICAgLy8gfQ0KICAgICAgICBtZS5hdXRvTnVtZXJpYy5zZXQodmFsdWUpOw0KICAgICAgICBtZS51cGRhdGVWTW9kZWwoKTsNCiAgICAgICAgbWUuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgICB0aGlzLiRlbWl0KCJjaGFuZ2UiLCBtZS5nZXRWYWx1ZSgpLCBldmVudCk7DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0sDQogICAgbGVzcygpIHsNCiAgICAgIC8vZGlzYWJsZSB0aMOsIGtow7RuZyBsw6BtIGfDrA0KICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmNoYW5nZUZvY3VzKHRydWUpOw0KICAgICAgbGV0IG1lID0gdGhpczsNCiAgICAgIGxldCB2YWx1ZSA9IG1lLmdldFZhbHVlKCk7DQogICAgICBpZiAoIXZhbHVlKSB7DQogICAgICAgIHZhbHVlID0gMDsNCiAgICAgIH0NCiAgICAgIHZhbHVlID0gcGFyc2VJbnQodmFsdWUpOw0KICAgICAgaWYgKHZhbHVlID4gbWUubWluKSB7DQogICAgICAgIHZhbHVlIC09IG1lLnN0ZXA7DQogICAgICAgIC8vIGlmICh2YWx1ZSA8IDEwKSB7DQogICAgICAgIC8vIAl2YWx1ZSA9ICcwJyArIHZhbHVlOw0KICAgICAgICAvLyB9DQogICAgICAgIG1lLnVwZGF0ZVZNb2RlbCgpOw0KICAgICAgICBtZS4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICAgIHRoaXMuJGVtaXQoImNoYW5nZSIsIG1lLmdldFZhbHVlKCksIGV2ZW50KTsNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgICBtZS5hdXRvTnVtZXJpYy5zZXQodmFsdWUpOw0KICAgIH0sDQogICAgLyoqDQogICAgICogTOG6pXkgZ2nDoSB0cuG7iyBj4bunYSBjb250cm9sDQogICAgICovDQogICAgZ2V0VmFsdWUoKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBpZiAoIW1lLmlzTnVsbGFibGUgfHwgbWUuYXV0b051bWVyaWMucmF3VmFsdWUpIHsNCiAgICAgICAgLy8gaWYodGhpcy52YWx1ZSAmJiB0aGlzLnZhbHVlLnRvU3RyaW5nKCkuc3BsaXQoJy4nKVsxXSAmJiB0aGlzLnZhbHVlLnRvU3RyaW5nKCkuc3BsaXQoJy4nKVsxXS5sZW5ndGggPiBGb3JtYXRVdGlsLmdldERlY2ltYWxEaWdpdEJ5Rm9ybWF0VHlwZShtZS5mb3JtYXRUeXBlKSkNCiAgICAgICAgLy8gew0KICAgICAgICAvLyAJbWUuYXV0b051bWVyaWMuc2V0KHRoaXMudmFsdWUpOw0KICAgICAgICAvLyAJcmV0dXJuIHRoaXMudmFsdWU7DQogICAgICAgIC8vIH0NCiAgICAgICAgcmV0dXJuIG1lLmF1dG9OdW1lcmljLmdldE51bWJlcigpOw0KICAgICAgfQ0KICAgIH0sDQogICAgLyoqDQogICAgICogR8OhbiBnacOhIHRy4buLIHbDoG8gY29udHJvbA0KICAgICAqLw0KICAgIHNldEludGVybmFsVmFsdWUodmFsdWUpIHsNCiAgICAgIGxldCBtZSA9IHRoaXM7DQogICAgICBtZS5hdXRvTnVtZXJpYy5zZXQodmFsdWUpOw0KICAgICAgbWUudXBkYXRlVk1vZGVsKCk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBT4buxIGtp4buHbiBuZ8aw4budaSBkw7luZyBnw7UgdsOgbyDDtCBpbnB1dCAoZMO5bmcgxJHhu4MgYuG6rXQgY+G7nSB0eXBpbmcpDQogICAgICovDQogICAgb25JbnB1dCgpIHsNCiAgICAgIHRoaXMudHlwaW5nID0gdHJ1ZTsNCiAgICB9LA0KDQogICAgb25CbHVyKCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgdGhpcy50eXBpbmcgPSBmYWxzZTsNCiAgICAgIC8vIG1lLmF1dG9OdW1lcmljLnNldChtZS52YWx1ZSk7DQogICAgfSwNCiAgICBzZXRWYWx1ZSh2YWx1ZSkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KDQogICAgICBpZiAobWUuJHJlZnMuaW5wdXQpIHsNCiAgICAgICAgbWUuJHJlZnMuaW5wdXQudmFsdWUgPSBudWxsOw0KICAgICAgfQ0KDQogICAgICBpZiAobWUuYXV0b051bWVyaWMgJiYgdHlwZW9mIHZhbHVlICE9PSAidW5kZWZpbmVkIiAmJiB2YWx1ZSAhPSBudWxsKSB7DQogICAgICAgIG1lLnNldEludGVybmFsVmFsdWUodmFsdWUpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbWUuaW5uZXJWYWx1ZSA9IHZhbHVlOw0KICAgICAgICBtZS52YWx1ZSA9IHZhbHVlOw0KICAgICAgfQ0KICAgIH0sDQogICAgb25JbnB1dENsaWNrKCkgew0KICAgICAgLy8gdGhpcy5zZWxlY3RBbGxUZXh0V2hlbkNsaWNrKHRoaXMuJHJlZnMuY29tYm9JbnB1dCk7DQogICAgfSwNCiAgICBvbklucHV0Rm9jdXMoKSB7DQogICAgICAvLyB0aGlzLnRyYWNrRm9jdXMoKTsNCiAgICB9LA0KICB9LA0KICBjb21wb25lbnRzOiB7fSwNCn07DQo8L3NjcmlwdD4NCjxzdHlsZSBsYW5nPSJzY3NzIiBzY29wZWQ+DQovLyBAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiAxMzY2cHgpIHsNCi8vIAlAaW1wb3J0ICdAL2Fzc2V0cy9zY3NzL19zbS12YXJpYWJsZXMuc2Nzcyc7DQovLyAJQGltcG9ydCAnQC9hc3NldHMvc2Nzcy9jb21wb25lbnRzL21zTnVtYmVyLnNjc3MnOw0KLy8gfQ0KLy8gQG1lZGlhIHNjcmVlbiBhbmQgKG1pbi13aWR0aDogMTM2N3B4KSB7DQovLyAJQGltcG9ydCAnQC9hc3NldHMvc2Nzcy9fdmFyaWFibGVzLnNjc3MnOw0KLy8gCUBpbXBvcnQgJ0AvYXNzZXRzL3Njc3MvY29tcG9uZW50cy9tc051bWJlci5zY3NzJzsNCi8vIH0NCkBpbXBvcnQgIkAvYXNzZXRzL3Njc3MvX3ZhcmlhYmxlcy5zY3NzIjsNCkBpbXBvcnQgIkAvYXNzZXRzL3Njc3MvY29tcG9uZW50cy9tc051bWJlci5zY3NzIjsNCi50ZXh0LWN1cnJlbmN5IHsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICBsZWZ0OiA3MHB4Ow0KICB0b3A6IC0zNXB4Ow0KICBjb2xvcjogIzU0NTQ1NDsNCiAgei1pbmRleDogMTA7DQp9DQoNCi5yZXZlbnVlIHsNCiAgZmxvYXQ6IHJpZ2h0Ow0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIGJvdHRvbTogNTFweDsNCiAgcmlnaHQ6IDIwcHg7DQogIGNvbG9yOiAjNTQ1NDU0Ow0KICB6LWluZGV4OiAxMDsNCn0NCg0KLmVycm9yLXRleHQgew0KICBtYXJnaW4tdG9wOiAtNXB4Ow0KfQ0KPC9zdHlsZT4NCg
